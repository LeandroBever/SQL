CREATE DATABASE SUPERMERCADO_DB;
USE SUPERMERCADO_DB;

CREATE TABLE TB_EMPRESA (
ID_EMPRESA		 int NOT NULL AUTO_INCREMENT,
NM_EMPRESA 		VARCHAR(255),
B_ATIVO			 BIT,
Constraint PK_EMPRESA PRIMARY KEY (ID_EMPRESA)
);

CREATE TABLE TB_ESTADO (
	ID_ESTADO  int NOT NULL,
    NM_ESTADO VARCHAR(255),
    UF VARCHAR(2),
    Constraint PK_ESTADO PRIMARY KEY(ID_ESTADO)
);

INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(11,'Rondônia','RO');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(12,'Acre','AC');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(13,'Amazonas','AM');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(14,'Roraima','RR');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(15,'Para','PA');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(16,'Amapa','AP');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(17,'Tocantins','TO');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(21,'Maranhão','MA');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(22,'Piaui','PI');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(23,'Ceara','CE');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(24,'Rio Grande do Norte','RN');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(25,'Paraiba','PB');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(26,'Pernambuco','PE');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(27,'Alagoas','AL');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(28,'Sergipe','SE');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(29,'Bahia','BA');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(31,'Minas Gerais','MG');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(32,'Espírito Santo','ES');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(33,'Rio de Janeiro','RJ');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(35,'São Paulo','SP');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(41,'Parana','PR');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(42,'Santa Catarina','SC');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(43,'Rio Grande do Sul','RS');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(50,'Mato Grosso do Sul','MS');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(51,'Mato Grosso','MT');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(52,'Goias','GO');
INSERT INTO TB_ESTADO (ID_ESTADO,NM_ESTADO,UF)VALUES(53,'Distrito Federal','DF');


CREATE TABLE TB_CIDADE (
	ID_CIDADE int NOT NULL,
    NM_CIDADE VARCHAR(255),
    ID_ESTADO  int NOT NULL,
    Constraint PK_CIDADE PRIMARY KEY(ID_CIDADE),
	Constraint FOREIGN KEY (ID_ESTADO) REFERENCES TB_ESTADO(ID_ESTADO)
);

CREATE TABLE TB_ENDERECO (
	ID_ENDERECO  	int NOT NULL AUTO_INCREMENT,
    NM_ENDERECO 	VARCHAR(255),
    ID_CIDADE  		int NOT NULL,
    NM_COMPLEMENT 	VARCHAR(255),
    NM_NUMERO 		VARCHAR(50),
    NU_CEP 			INT,
    Constraint PK_ENDERECO PRIMARY KEY(ID_ENDERECO),
	Constraint FK_CIDADE FOREIGN KEY (ID_CIDADE) REFERENCES TB_CIDADE(ID_CIDADE)
);


CREATE TABLE TB_GRUPO_PRODUTO (
ID_GRUPO_PRODUTO 		SMALLINT NOT NULL AUTO_INCREMENT,
NM_GRUPO_PRODUTO 		VARCHAR(255),
B_ATIVO 				BIT,
Constraint PK_GRUPO_PRODUTO PRIMARY KEY (ID_GRUPO_PRODUTO)
); 

CREATE TABLE TB_DEPARTAMENTO (
ID_DEPARTAMENTO 		SMALLINT NOT NULL AUTO_INCREMENT,
NM_DEPARTAMENTO 		VARCHAR(255),
B_ATIVO 				BIT,
Constraint PK_DEPARTAMENTO PRIMARY KEY (ID_DEPARTAMENTO)
);

CREATE TABLE TB_UNIDADE (
ID_UNIDADE 				TINYINT NOT NULL AUTO_INCREMENT, 
NM_UNIDADE 				VARCHAR(255),
CODE_UNIDADE 			VARCHAR(2),
B_ATIVO 				BIT,
Constraint PK_UNIDADE PRIMARY KEY (ID_UNIDADE)
);

CREATE TABLE TB_PRODUTO (
ID_PRODUTO				INT NOT NULL AUTO_INCREMENT,
NM_PRODUTO				VARCHAR(255),
CODE_BARRA				VARCHAR(20),
VR_CUSTO				DECIMAL(8,2),
VR_MARGEM				DECIMAL(8,2),
VR_VENDA				DECIMAL(8,2),
ID_GRUPO_PRODUTO 		SMALLINT,
ID_DEPARTAMENTO 		SMALLINT,
ID_UNIDADE 				TINYINT,
B_ATIVO					BIT,
DATA_CADASTRO			DATETIME,
Constraint PK_PRODUTO PRIMARY KEY (ID_PRODUTO),
Constraint FK_GRUPO_PRODUTO foreign key (ID_GRUPO_PRODUTO) references TB_GRUPO_PRODUTO (ID_GRUPO_PRODUTO),
Constraint FK_UNIDADE foreign key (ID_UNIDADE) references TB_UNIDADE (ID_UNIDADE),
Constraint FK_DEPARTAMENTO foreign key (ID_DEPARTAMENTO) references TB_DEPARTAMENTO (ID_DEPARTAMENTO),
Constraint FK_CLASSIFICACAO_FISCAL foreign key (ID_CLASSIFICACAO_FISCAL) references TB_CLASSIFICACAO_FISCAL (ID_CLASSIFICACAO_FISCAL)
);

CREATE TABLE TB_CLASSIFICACAO_FISCAL (
ID_CLASSIFICACAO_FISCAL SMALLINT NOT NULL AUTO_INCREMENT,
NM_CLASSIFICACAO_FISCAL VARCHAR(255),
CODE_CLASSIFICACAO_FISCAL SMALLINT,
B_ATIVO BIT,
Constraint PK_CLASSIFICACAO_FISCAL PRIMARY KEY (ID_CLASSIFICACAO_FISCAL)
);

create table TB_CLIENTE (
ID_CLIENTE			INT NOT NULL auto_increment,
NM_CLIENTE			VARCHAR(255),
NU_CPF				INT,
NU_RG				VARCHAR(30),
DT_NASCIMENTO		DATETIME,
ID_ENDERECO			INT,
DT_ULTIMA_COMPRA	DATETIME,
CONSTRAINT PK_CLIENTE PRIMARY KEY (ID_CLIENTE),
Constraint FK_ENDERECO FOREIGN KEY (ID_ENDERECO) references TB_ENDERECO (ID_ENDERECO)
);

create table TB_PEDIDO (
ID_PEDIDO			BIGINT NOT NULL auto_increment,
ID_CLIENTE			INT,
DT_PEDIDO			DATETIME,
ID_ENDERECO			INT,
VL_PEDIDO_TOTAL		NUMERIC(8,2),
VL_DESCONTO			NUMERIC(8,2),
VL_PEDIDO_LIQUIDO	NUMERIC(8,2),
Constraint PK_PEDIDO PRIMARY KEY (ID_PEDIDO),
Constraint FK_CLIENTE FOREIGN KEY (ID_CLIENTE) REFERENCES TB_CLIENTE (ID_CLIENTE),
Constraint FK_ENDERECO FOREIGN KEY (ID_ENDERECO) REFERENCES TB_ENDERECO (ID_ENDERECO)
);

create table TB_PEDIDO_ITEM (
ID_PEDIDO_ITEM		BIGINT NOT NULL auto_increment, 
ID_PEDIDO			BIGINT,
ID_PRODUTO			INT,
ID_UNIDADE			TINYINT,
VL_PRODUTO			NUMERIC(8,2),
QTDE_PRODUTO		NUMERIC(8,2),
VL_DESCONTO			NUMERIC(8,2),
VL_TOTAL_ITEM		NUMERIC(8,2),
constraint PK_PEDIDO_ITEM PRIMARY KEY (ID_PEDIDO_ITEM),
constraint  FOREIGN KEY (ID_PRODUTO) REFERENCES TB_PRODUTO (ID_PRODUTO),
constraint  FOREIGN KEY (ID_PEDIDO) REFERENCES TB_PEDIDO (ID_PEDIDO),
constraint  foreign key (ID_UNIDADE) REFERENCES TB_UNIDADE (ID_UNIDADE)
);

SELECT table_name, table_type
FROM information_schema.tables
Where TABLE_SCHEMA = 'supermercado_db';

ALTER TABLE TB_PEDIDO DROP FOREIGN KEY FK_ENDERECO;
ALTER TABLE TB_PEDIDO DROP ID_ENDERECO;


select* from TB_PEDIDO

use supermercado_db

INSERT INTO TB_EMPRESA (
	NM_EMPRESA,
    B_ATIVO
)
VALUES (
	'MATRIZ SUPERMERCADO',
	1
);

INSERT INTO TB_CIDADE (
	NM_CIDADE,
    ID_ESTADO
)
VALUES (
	'FLORIANOPOLIS',
    42
);

INSERT INTO TB_CIDADE (
	NM_CIDADE,
    ID_ESTADO
)
VALUES (
	'PALHOCA',
    42
);

INSERT INTO TB_CIDADE (
	NM_CIDADE,
    ID_ESTADO
)
VALUES (
	'IMBITUBA',
    42
);

INSERT INTO TB_CIDADE (
	NM_CIDADE,
    ID_ESTADO
)
VALUES (
	'SANTO AMARO DA IMPERATRIZ',
    42
);

INSERT INTO TB_CIDADE (
	NM_CIDADE,
    ID_ESTADO
)
VALUES (
	'SAO JOSE',
    42
);

INSERT INTO TB_CIDADE (
	NM_CIDADE,
    ID_ESTADO
)
VALUES (
	'BIGUAÇU',
    42
);

INSERT INTO TB_CIDADE (
	NM_CIDADE,
    ID_ESTADO
)
VALUES (
	'SAO PAULO',
    35
);

INSERT INTO TB_CIDADE (
	NM_CIDADE,
    ID_ESTADO
)
VALUES (
	'RIO DE JANEIRO',
    33
);

SET FOREIGN_KEY_CHECKS=0;

DROP TABLE TB_CIDADE;

SELECT * FROM TB_ESTADO WHERE UF = 'RJ';

CREATE TABLE TB_CIDADE (
	ID_CIDADE int NOT NULL AUTO_INCREMENT,
    NM_CIDADE VARCHAR(255),
    ID_ESTADO  int NOT NULL,
    Constraint PK_CIDADE PRIMARY KEY(ID_CIDADE),
	Constraint FOREIGN KEY (ID_ESTADO) REFERENCES TB_ESTADO(ID_ESTADO)
);

SELECT * FROM TB_CIDADE

UPDATE TB_CIDADE SET NM_CIDADE;

use supermercado_db
